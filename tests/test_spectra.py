import os

import numpy as np

import mute.constants as mtc
import mute.underground as mtu


def test_u_ang_dist():

    mtc.clear()
    mtc.set_verbose(0)
    mtc.set_overburden("mountain")
    mtc.set_reference_density(2.72)
    mtc.load_mountain("LNGS")

    u_ang_dist_calc = mtu.calc_u_ang_dist(
        kind="zenith", model="daemonflux", output=False, force=True
    )
    u_ang_dist_read = [
        6.42399522e-08,
        7.25018960e-08,
        7.76332714e-08,
        7.98038570e-08,
        8.12272487e-08,
        8.25206082e-08,
        8.42350073e-08,
        8.56617277e-08,
        8.62606174e-08,
        8.65087861e-08,
        8.64939871e-08,
        8.61543533e-08,
        8.54046645e-08,
        8.42920415e-08,
        8.29468845e-08,
        8.12907313e-08,
        7.94858933e-08,
        7.76985731e-08,
        7.58408747e-08,
        7.40547038e-08,
        7.23566774e-08,
        7.07557421e-08,
        6.92502616e-08,
        6.77114598e-08,
        6.60821074e-08,
        6.44274060e-08,
        6.27448673e-08,
        6.09284457e-08,
        5.90056721e-08,
        5.69732639e-08,
        5.48218545e-08,
        5.20426889e-08,
        4.95452738e-08,
        4.71579086e-08,
        4.47989437e-08,
        4.26063072e-08,
        4.04454564e-08,
        3.84773645e-08,
        3.64277875e-08,
        3.39877107e-08,
        3.20296551e-08,
        3.03030113e-08,
        2.86393129e-08,
        2.70709181e-08,
        2.54815616e-08,
        2.38717045e-08,
        2.21676554e-08,
        2.05315886e-08,
        1.90784027e-08,
        1.78905803e-08,
        1.68830541e-08,
        1.59045780e-08,
        1.51336310e-08,
        1.43851377e-08,
        1.36525889e-08,
        1.29081225e-08,
        1.22098946e-08,
        1.14772167e-08,
        1.07749901e-08,
        1.01391551e-08,
        9.56324722e-09,
        9.04692024e-09,
        8.56103965e-09,
        8.09118573e-09,
        7.67895696e-09,
        7.26852767e-09,
        6.82832537e-09,
        6.51004131e-09,
        6.30791477e-09,
        6.08189528e-09,
        5.90182309e-09,
        5.69344604e-09,
        5.49932565e-09,
        5.30590558e-09,
        5.11502935e-09,
        4.90112977e-09,
        4.72291788e-09,
        4.56300730e-09,
        4.38191380e-09,
        4.16571018e-09,
        3.87914611e-09,
        3.61612872e-09,
        3.33314750e-09,
        3.06503834e-09,
        2.72151613e-09,
        2.43635863e-09,
        2.18302028e-09,
        1.91749312e-09,
        1.65878692e-09,
        1.39399764e-09,
        1.18666988e-09,
        1.01019382e-09,
        8.14472690e-10,
        6.33539451e-10,
        4.91731717e-10,
        3.60941251e-10,
        2.73959779e-10,
        2.07981482e-10,
        1.52470179e-10,
        1.00562875e-10,
    ]

    assert np.allclose(u_ang_dist_calc, u_ang_dist_read)


def test_u_e_spect():

    mtc.clear()

    u_e_spect_calc = mtu.calc_u_e_spect(model="daemonflux", output=False, force=True)
    u_e_spect_read = [
        0.00000000e00,
        9.32613342e-13,
        2.90264821e-12,
        3.94677811e-12,
        4.59987603e-12,
        4.86706076e-12,
        5.08736771e-12,
        5.00266157e-12,
        5.06006026e-12,
        4.87930498e-12,
        4.82987705e-12,
        4.65524666e-12,
        4.51098817e-12,
        4.39174551e-12,
        4.26546480e-12,
        4.18933164e-12,
        4.09355959e-12,
        3.92054028e-12,
        3.85283423e-12,
        3.70344988e-12,
        3.58540617e-12,
        3.40899736e-12,
        3.28588872e-12,
        3.10054987e-12,
        2.94943248e-12,
        2.75057457e-12,
        2.54182832e-12,
        2.29267365e-12,
        2.02953408e-12,
        1.84540862e-12,
        1.62789127e-12,
        1.27635004e-12,
        9.36877206e-13,
        8.15121290e-13,
        6.05599205e-13,
        3.87345148e-13,
        3.00956625e-13,
        1.74764762e-13,
        1.16314468e-13,
        6.86638693e-14,
        3.77371821e-14,
        2.10798986e-14,
        1.11742269e-14,
        5.64037327e-15,
        2.76758955e-15,
        1.32536065e-15,
        6.22873854e-16,
        2.86849143e-16,
        1.30026653e-16,
        5.81850984e-17,
        2.57474884e-17,
        1.13097340e-17,
        4.92032085e-18,
        2.13213979e-18,
        9.19388086e-19,
        3.94427819e-19,
        1.68892333e-19,
        7.21157779e-20,
        3.06380187e-20,
        1.29963462e-20,
        5.49742315e-21,
        2.31710338e-21,
        9.72085136e-22,
        4.07655136e-22,
        1.70100031e-22,
        7.09861194e-23,
        2.96459291e-23,
        1.23943036e-23,
        5.20817849e-24,
        2.20880159e-24,
        9.49876013e-25,
        4.15868172e-25,
        1.85821243e-25,
        8.46218134e-26,
        3.93773360e-26,
        1.85502475e-26,
        8.86142661e-27,
        4.26268379e-27,
        2.06694082e-27,
        1.00119444e-27,
        4.85208585e-28,
        2.34529700e-28,
        1.12721809e-28,
        5.37343842e-29,
        2.52404021e-29,
        1.15372061e-29,
        4.99680290e-30,
        1.89864499e-30,
        4.83876246e-31,
        0.00000000e00,
        0.00000000e00,
    ]

    assert np.allclose(u_e_spect_calc, u_e_spect_read)
